<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
       <!-- Material Design for Bootstrap fonts and icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
    <!-- Material Design for Bootstrap CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous">

    <!--jquery ui-->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js" integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9" crossorigin="anonymous"></script>

    <link th:href="@{css/jquery.range.css}" rel="stylesheet">
    <script th:src="@{lib/jquery.range.js}"></script>

    <script>$(document).ready(function() { $('body').bootstrapMaterialDesign(); });</script>
    <title>Hello, world!</title>
    <style>
        .bmd-layout-container{
            width: 600px;
            height: 1000px;
        }
        .search-query:focus + button {
            z-index: 3;
        }

        .col-6 {
            flex: 0 0 50%;
            max-width: 50%;
            width: 40%;
            height: 250px;
        }
        .col-6 img{
            width: 250px;
            height: 200px;

        }
        .row {
            display: flex;
            flex-wrap: wrap;
            margin-right: 0px;
            margin-left: 0px;
        }
        .modal-body1 .row {
            padding-top: 10px;
        }

        .form-control:focus {
            box-shadow: none;
        }
        .form-control::placeholder {
            font-size: 0.95rem;
            color: #aaa;
            font-style: italic;
        }
        .rounded {
            border-radius: 42.125rem!important;
        }


    </style>
</head>
<body>
<div class="bmd-layout-container bmd-drawer-f-l bmd-drawer-overlay mx-auto">
    <header class="bmd-layout-header mb-3" style="height: 7%">
        <div class="navbar navbar-light bg-faded" style="height: 94%">
            <button class="navbar-toggler" type="button" data-toggle="drawer" data-target="#dw-s2">
                <span class="sr-only">Toggle drawer</span>
                <i class="material-icons">menu</i>
            </button>
            <ul class="nav navbar-nav mx-auto">
                <li class="nav-item mx-auto"><h4>Festival</h4></li>
            </ul>
        </div>
    </header>

    <!-- 본문 검색창 -->

    <div class="p-1 bg-light rounded shadow-sm mb-3 w-50 mx-auto" id="searchbar1">
        <div class="input-group pl-3 ">
            <input type="search" id="searchword1" placeholder="What're you searching for?" aria-describedby="button-addon1" class="form-control border-0 bg-light">
            <div class="input-group-append">
                <button id="button-addon1" type="submit" class="btn btn-link text-primary"><i class="fa fa-search"></i></button>
            </div>
        </div>
    </div>

    <div id="dw-s2" class="bmd-layout-drawer bg-faded">
        <header>
            <a class="navbar-brand">Sidebar</a>
        </header>
        <ul class="list-group">
            <a class="list-group-item" data-toggle="modal" data-target="#Modal1"><i class="fas fa-calendar-alt"></i>조건검색</a>
            <a class="list-group-item"><i class="fas fa-user"></i>로그인</a>
        </ul>
    </div>

    <!-- 기간검색 modal -->
    <div class="modal fade" id="Modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalLabel">조건검색</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="container-fluid modal-body1">
                    <hr>
                    <div class="row">
                        <div class="col"><h5>날짜</h5></div>
                    </div>
                    <div class="row">

                        <div class="col mb-4 ml-1">
                            <input class="range-slider " type="hidden" value="3,9">

                        </div>
                    </div>
                </div>
                <div class="container-fluid modal-body2">
                    <hr>
                    <div class="row">
                        <div class="col"><h5>지역</h5></div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary active" value="" >
                                    전체
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="서울특별시" id="area_button1">
                                    서울
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="강원도"  id="area_button2">
                                    강원
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="대전광역시" id="area_button3">
                                    대전
                                </label></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="충청남도" id="area_button4">
                                    충남
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="세종특별자치시" id="area_button5">
                                    세종
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="충청북도" id="area_button6">
                                    충북
                                </label></div>
                        </div>
                        <div class="col">

                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="인천광역시" id="area_button7">
                                    인천
                                </label></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="경기도" id="area_button8">
                                    경기
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="광주광역시" id="area_button9">
                                    광주
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="전라남도" id="area_button10">
                                    전남
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="전라북도" id="area_button11">
                                    전북
                                </label></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="부산광역시" id="area_button12">
                                    부산
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="경상남도" id="area_button13">
                                    경남
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="울산광역시" id="area_button14">
                                    울산
                                </label></div>
                        </div>
                        <div class="col">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="제주특별자치도" id="area_button15">
                                    제주
                                </label></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="대구광역시" id="area_button16">
                                    대구
                                </label></div>
                        </div>
                        <div class="col-3">
                            <div class="btn-group-toggle" data-toggle="buttons">
                                <label class="btn area_button btn-secondary" value="경상북도" id="area_button17">
                                    경북
                                </label></div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid modal-body3">
                    <hr>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-primary" onclick="conditional_search();">검색</button>
                </div>
            </div>
        </div>
    </div>

    <main class="bmd-layout-content mx-auto h-50">
        <ul class="list-unstyled list-thumbs">

        </ul>
    </main>
</div>

</body>
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/

    //날씨선택 slider
    $('.range-slider').jRange({
        from: 1,
        to: 12,
        scale: [1,12],
        isRange : true,
        width: 420,
        format: '%s월',

    });

    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0');
    var yyyy = today.getFullYear();
    today = yyyy + mm + dd;

    var startmonth = /*[[ ${startmonth} ]]*/;
    var endmonth = /*[[ ${endmonth} ]]*/;
    var region = /*[[ ${area} ]]*/;
    var search = /*[[ ${search} ]]*/;

    var checker = 0; // main : 0, search : 1, codition : 2

    //첫 화면의 축제 리스트 출력
    $( document ).ready(function() {

        if(startmonth  != '00'){ // 조건검색
            checker = 2;
            if(region == "0")
                region = null;
            startmonth = yyyy + startmonth + '01';
            endmonth = yyyy + endmonth + '31';
            print_festivalList("con", 0, startmonth, endmonth, region);
        }
        else if(search != '0'){
            checker = 1;
            print_festivalList("search", 0, today, null, null, search);
        }
        else { //메인
            checker = 0;
            print_festivalList("main", 0, today);
        }
    });


    //조건 검색
    function conditional_search() {

        var url = '?startmonth=' + $('.pointer-label.low').text().split('월')[0] +
            '&endmonth=' + $('.pointer-label.high').text().split('월')[0];


        url += '&area=';
        $('.modal-body2').find('.active').each(function() {
            var temp = $(this).attr('value').trim();
            url += temp;
        });
        $('.modal-body3').find('.active').each(function() {
            var temp = $(this).text().trim();
            if(temp != '전체')
                url += '+' + temp;
        });

        location.href =  location.href.split('?')[0] + url;

    }

    //세부 지역 목록
    var area = Array(Array(),Array());

    area[0] = [];
    //서울
    area[1] = ['전체','강남구','도봉구','동대문구','동작구','마포구','서대문구','서초구',
        '성동구','성북구','송파구','양천구','강동구','영등포구','용산구',
        '은평구','종로구','중구','중랑구','강북구','강서구','관악구','광진구',
        '구로구','금천구','노원구'];
    //강원
    area[2] = ['전체','춘천시','화천군','강릉시','양양군','속초시','고성군','원주시','횡성군',
        '영월군','평창군','정선군','태백시','동해시','삼척시','홍천군','인제군',
        '양구군','철원군'];
    //대전
    area[3] = ['전체','동구','중구','서구','유성구','대덕구'];
    //충남
    area[4] = ['전체','금산군','공주시','논산시','계룡시','부여군','서천군','천안시','아산시',
        '예산군','당진군','청양군','홍성군','보령시','서산시','태안군'];
    //세종
    area[5] = ['전체'];
    //충북
    area[6] = ['전체','청주시','청원군','진천군','괴산군','증평군','음성군','영동군','옥천군',
        '보은군','충주시','제천시','단양군'];
    //인천
    area[7] = ['전체','중구','동구','남구','부평구','서구','남동구','연수구','계양구','동진군',
        '강화군'];
    //경기
    area[8] = ['전체','고양시','김포시','부천시','광명시','안산시','과천시','시흥시','안양시',
        '과천시','시흥시','안양시','군포시','의왕시','수원시','화성시','오산시',
        '평택시','용인시','안성시','성남시','광주시','하남시'];
    //광주
    area[9] = ['전체','북구','동구','서구','남구','광산구'];
    //전남
    area[10] = ['전체','영광군','장성군','곡성군','담양군','화순군','나주시','함평군','영암군',
        '강진군','장흥군','목포시','무안군','신안군','해남군','완도군','진도군',
        '순천시','구례군','광양시','보성군','고흥군','여수시'];
    //전북
    area[11] = ['전체','전주시','완주군','임실군','진안군','무주군','익산시','군산시','김제시',
        '부안군','정읍시','고창군','남원시','순창군','장수군'];
    //부산
    area[12] = ['전체','중구','동구','서구','사하구','영도구','동래구','남구','금정구','연제구',
        '해운대구','수영구','부산지구','북구','사상구','강서구','기장군'];
    //경남
    area[13] = ['전체','김해시','양산시','밀양시','창원시','창녕군','의령군','함안군','고성군',
        '통영시','거제시','진주시','사천시','산청군','하동군','남해군','거창군',
        '함양군','합천군'];
    //울산
    area[14] = ['전체','남구','중구','동구','북구','울주군'];
    //제주
    area[15] = ['전체','제주시','서귀포시'];
    //대구
    area[16] = ['전체','중구','동구','북구','서구','달서구','남구','수성구','달성군'];
    //경북
    area[17] = ['전체','경산시','청도군','군위군','고령군','칠곡군','성주군','구미시',
        '김천시','상주시','문경시','영주시','봉화군','예천군','안동시',
        '청송군','영양군','영덕군','울진군','의성군','영천시','경주시',
        '포항시','울릉군'];


    //지역 선택
    $(document).on('click','.area_button',function () {
        $('.area_button').removeClass('active');
        $('this').addClass('active');

        //세부 지역
        $(".modal-body3").empty();
        $(".modal-body3").append("<hr>");

        $detail_area_row = $('<div class="row"></div>');
        $areaindex = $(this).attr('id').substr(11,$(this).attr('id').length);


        for(var i=0;i<=area[$areaindex].length;i++){

            $detail_area_col = $('<div class="col-3">\n' +
                '                      <div class="btn-group-toggle" data-toggle="buttons">' +
                '                             <label class="btn area_detail_button btn-secondary">' +
                '                             </label></div>\n' +
                '                  </div>');

            $detail_area_col.children().children().text(area[$areaindex][i]); //지역명 저장
            $detail_area_row.append($detail_area_col); //row에 col 추가

            if(i%4 == 3 || i == area[$areaindex].length) { //새로운 줄(row 변경)
                $('.modal-body3').append($detail_area_row);
                $detail_area_row = $('<div class="row"></div>');
            }
        }
    });

    //지역 세부 선택
    $(document).on('click','.area_detail_button',function () {
        $('.area_detail_button').removeClass('active');
        $('this').addClass('active');
        //alert($('.bmd-layout-content').height());
    });



    //스크롤 이벤트
    var myVar = setInterval(myTimer, 600);
    var once;

    function myTimer() {
        once=0;
    }

    //제목창의 검색바 (스크롤 내렸을때 위에보이는거)
    $searchbar2=$('<div class="p-1 bg-light rounded shadow-sm w-90 mx-auto" id="searchbar2">\n' +
        '            <div class="input-group pl-3 ">\n' +
        '                <input type="search" id="searchword" placeholder="What\'re you searching for?" aria-describedby="button-addon1" class="form-control border-0 bg-light">\n' +
        '                <div class="input-group-append">\n' +
        '                    <button id="button-addon" type="submit" class="btn btn-link text-primary"><i class="fa fa-search"></i></button>\n' +
        '                </div>\n' +
        '            </div>\n' +
        '        </div>');

    $('.nav.navbar-nav.mx-auto').append($searchbar2);
    $('#searchbar2').hide(); //안보이게


    //화면의 높이 구하는 식
    $body_height_px = $('.bmd-layout-container').css('height');
    $body_height = $body_height_px.substring(0,$body_height_px.length-2);


    var pagenum = 0;//0값이면 searchfestival에 의해 한번 출력되고 또됨 1이면        main인경우
    $('.bmd-layout-content').scroll(function() {

        //스크롤 내리면 축제 리스트 추가
        if($(this).children().height() - $(this).scrollTop() <= $body_height){

            if (once == 0) {

                if(checker == 1)
                    print_festivalList("search", ++pagenum, today, null, null, str);
                else if(checker == 2)
                    print_festivalList("con", ++pagenum, startmonth, endmonth, region);
                else
                    print_festivalList("main", ++pagenum, today);


                once += 1;
            }
        }
        //검색창 사라지게
        if($(this).scrollTop() != 0) {
            $('#searchbar1').hide();
            $('.nav-item').hide();
            $('#searchbar2').show("bounce",300);
        }
        else {
            $('#searchbar1').show();
            $('.nav-item').show();
            $('#searchbar2').hide();
        };
    });

    $(document).on('click','#button-addon1',function (){
        var str = document.getElementById("searchword1").value;
        location.href =  location.href.split('?')[0] + "?search=" + str;
    });
    $(document).on('click','#button-addon',function (){
        var str = document.getElementById("searchword").value;
        location.href =  location.href.split('?')[0] + "?search=" + str;
    });

    function print_festivalList(category, pagenum, date1, date2, address, title){
        var param = {"pageNo": pagenum,"numOfRows": "10","title" : title,
            "eventStartDate": date1, "eventEndDate": date2, "address" : address, "category" : category};
        $.ajax({
            url: "/api/festivalInfo",
            type: "POST",
            dataType: "json",
            contentType: "application/json",
            data : JSON.stringify(param),
        }).done(function( data ) {
            $appendData = $('<div class="row"></div>');
            for(var i=0;i<data.length;i++) {

                $festival_item = $('<li class="col-6">\n' +
                    '               <a href="#">\n' +
                    '                   <img src="" alt="Barca" class="img-responsive" height="130px" />\n' +
                    '                   <p></p>\n' +
                    '               </a>\n' +
                    '           </li>');

                $festival_item.find('p').text(data[i].title);
                $festival_item.find('a').attr('href',"content/" + data[i].contentId);
                $festival_item.children().children('img').attr('src',data[i].firstImage2);
                $appendData.append($festival_item);
            }
            //alert("printFestialInfo완료")
            $('.list-unstyled.list-thumbs').append($appendData);
            //.hide().fadeIn("fast");
        }).fail(function() {
        });
    }

    /*]]>*/
</script>
</html>